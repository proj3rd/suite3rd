(()=>{"use strict";var e={648:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const r=s(896),o=s(928),i=s(756),n=s(23),a=s(326),c=s(184),d=s(106),l=s(861),u=s(798),p=s(991),h=s(844),f=s(912),m=(0,n.promisify)(r.readdir),w=(0,n.promisify)(r.mkdir),g=(0,n.promisify)(r.stat),v=(0,n.promisify)(r.open),y=(0,n.promisify)(r.close),k=(0,n.promisify)(r.unlink);async function S(e){try{return await e()}catch(e){return}}t.Client=class{constructor(e=3e4){this.availableListCommands=["LIST -a","LIST"],this.ftp=new a.FTPContext(e),this.prepareTransfer=this._enterFirstCompatibleMode([h.enterPassiveModeIPv6,h.enterPassiveModeIPv4]),this.parseList=c.parseList,this._progressTracker=new d.ProgressTracker}close(){this.ftp.close(),this._progressTracker.stop()}get closed(){return this.ftp.closed}connect(e="localhost",t=21){return this.ftp.reset(),this.ftp.socket.connect({host:e,port:t,family:this.ftp.ipFamily},(()=>this.ftp.log(`Connected to ${(0,p.describeAddress)(this.ftp.socket)} (${(0,p.describeTLS)(this.ftp.socket)})`))),this._handleConnectResponse()}connectImplicitTLS(e="localhost",t=21,s={}){return this.ftp.reset(),this.ftp.socket=(0,i.connect)(t,e,s,(()=>this.ftp.log(`Connected to ${(0,p.describeAddress)(this.ftp.socket)} (${(0,p.describeTLS)(this.ftp.socket)})`))),this.ftp.tlsOptions=s,this._handleConnectResponse()}_handleConnectResponse(){return this.ftp.handle(void 0,((e,t)=>{e instanceof Error?t.reject(e):(0,f.positiveCompletion)(e.code)?t.resolve(e):t.reject(new a.FTPError(e))}))}send(e,t=!1){return t?(this.ftp.log("Deprecated call using send(command, flag) with boolean flag to ignore errors. Use sendIgnoringError(command)."),this.sendIgnoringError(e)):this.ftp.request(e)}sendIgnoringError(e){return this.ftp.handle(e,((e,t)=>{e instanceof a.FTPError?t.resolve({code:e.code,message:e.message}):e instanceof Error?t.reject(e):t.resolve(e)}))}async useTLS(e={},t="AUTH TLS"){const s=await this.send(t);return this.ftp.socket=await(0,p.upgradeSocket)(this.ftp.socket,e),this.ftp.tlsOptions=e,this.ftp.log(`Control socket is using: ${(0,p.describeTLS)(this.ftp.socket)}`),s}login(e="anonymous",t="guest"){return this.ftp.log(`Login security: ${(0,p.describeTLS)(this.ftp.socket)}`),this.ftp.handle("USER "+e,((e,s)=>{e instanceof Error?s.reject(e):(0,f.positiveCompletion)(e.code)?s.resolve(e):331===e.code?this.ftp.send("PASS "+t):s.reject(new a.FTPError(e))}))}async useDefaultSettings(){const e=(await this.features()).has("MLST");this.availableListCommands=e?["MLSD","LIST -a","LIST"]:["LIST -a","LIST"],await this.send("TYPE I"),await this.sendIgnoringError("STRU F"),await this.sendIgnoringError("OPTS UTF8 ON"),e&&await this.sendIgnoringError("OPTS MLST type;size;modify;unique;unix.mode;unix.owner;unix.group;unix.ownername;unix.groupname;"),this.ftp.hasTLS&&(await this.sendIgnoringError("PBSZ 0"),await this.sendIgnoringError("PROT P"))}async access(e={}){var t,s;const r=!0===e.secure;let o;if(o="implicit"===e.secure?await this.connectImplicitTLS(e.host,e.port,e.secureOptions):await this.connect(e.host,e.port),r){const r=null!==(t=e.secureOptions)&&void 0!==t?t:{};r.host=null!==(s=r.host)&&void 0!==s?s:e.host,await this.useTLS(r)}return await this.sendIgnoringError("OPTS UTF8 ON"),await this.login(e.user,e.password),await this.useDefaultSettings(),o}async pwd(){const e=await this.send("PWD"),t=e.message.match(/"(.+)"/);if(null===t||void 0===t[1])throw new Error(`Can't parse response to command 'PWD': ${e.message}`);return t[1]}async features(){const e=await this.sendIgnoringError("FEAT"),t=new Map;return e.code<400&&(0,f.isMultiline)(e.message)&&e.message.split("\n").slice(1,-1).forEach((e=>{const s=e.trim().split(" ");t.set(s[0],s[1]||"")})),t}async cd(e){const t=await this.protectWhitespace(e);return this.send("CWD "+t)}async cdup(){return this.send("CDUP")}async lastMod(e){const t=await this.protectWhitespace(e),s=(await this.send(`MDTM ${t}`)).message.slice(4);return(0,u.parseMLSxDate)(s)}async size(e){const t=`SIZE ${await this.protectWhitespace(e)}`,s=await this.send(t),r=parseInt(s.message.slice(4),10);if(Number.isNaN(r))throw new Error(`Can't parse response to command '${t}' as a numerical value: ${s.message}`);return r}async rename(e,t){const s=await this.protectWhitespace(e),r=await this.protectWhitespace(t);return await this.send("RNFR "+s),this.send("RNTO "+r)}async remove(e,t=!1){const s=await this.protectWhitespace(e);return t?this.sendIgnoringError(`DELE ${s}`):this.send(`DELE ${s}`)}trackProgress(e){this._progressTracker.bytesOverall=0,this._progressTracker.reportTo(e)}async uploadFrom(e,t,s={}){return this._uploadWithCommand(e,t,"STOR",s)}async appendFrom(e,t,s={}){return this._uploadWithCommand(e,t,"APPE",s)}async _uploadWithCommand(e,t,s,r){return"string"==typeof e?this._uploadLocalFile(e,t,s,r):this._uploadFromStream(e,t,s)}async _uploadLocalFile(e,t,s,o){const i=await v(e,"r"),n=(0,r.createReadStream)("",{fd:i,start:o.localStart,end:o.localEndInclusive,autoClose:!1});try{return await this._uploadFromStream(n,t,s)}finally{await S((()=>y(i)))}}async _uploadFromStream(e,t,s){const r=e=>this.ftp.closeWithError(e);e.once("error",r);try{const r=await this.protectWhitespace(t);return await this.prepareTransfer(this.ftp),await(0,h.uploadFrom)(e,{ftp:this.ftp,tracker:this._progressTracker,command:s,remotePath:r,type:"upload"})}finally{e.removeListener("error",r)}}async downloadTo(e,t,s=0){return"string"==typeof e?this._downloadToFile(e,t,s):this._downloadToStream(e,t,s)}async _downloadToFile(e,t,s){const o=s>0,i=o?"r+":"w",n=await v(e,i),a=(0,r.createWriteStream)("",{fd:n,start:s,autoClose:!1});try{return await this._downloadToStream(a,t,s)}catch(t){const s=await S((()=>g(e))),r=s&&s.size>0;throw!o&&!r&&await S((()=>k(e))),t}finally{await S((()=>y(n)))}}async _downloadToStream(e,t,s){const r=e=>this.ftp.closeWithError(e);e.once("error",r);try{const r=await this.protectWhitespace(t);return await this.prepareTransfer(this.ftp),await(0,h.downloadTo)(e,{ftp:this.ftp,tracker:this._progressTracker,command:s>0?`REST ${s}`:`RETR ${r}`,remotePath:r,type:"download"})}finally{e.removeListener("error",r),e.end()}}async list(e=""){const t=await this.protectWhitespace(e);let s;for(const e of this.availableListCommands){const r=""===t?e:`${e} ${t}`;await this.prepareTransfer(this.ftp);try{const t=await this._requestListWithCommand(r);return this.availableListCommands=[e],t}catch(e){if(!(e instanceof a.FTPError))throw e;s=e}}throw s}async _requestListWithCommand(e){const t=new l.StringWriter;await(0,h.downloadTo)(t,{ftp:this.ftp,tracker:this._progressTracker,command:e,remotePath:"",type:"list"});const s=t.getText(this.ftp.encoding);return this.ftp.log(s),this.parseList(s)}async removeDir(e){return this._exitAtCurrentDirectory((async()=>{await this.cd(e);const t=await this.pwd();await this.clearWorkingDir(),"/"===t||(await this.cdup(),await this.removeEmptyDir(t))}))}async clearWorkingDir(){for(const e of await this.list())e.isDirectory?(await this.cd(e.name),await this.clearWorkingDir(),await this.cdup(),await this.removeEmptyDir(e.name)):await this.remove(e.name)}async uploadFromDir(e,t){return this._exitAtCurrentDirectory((async()=>(t&&await this.ensureDir(t),await this._uploadToWorkingDir(e))))}async _uploadToWorkingDir(e){const t=await m(e);for(const s of t){const t=(0,o.join)(e,s),r=await g(t);r.isFile()?await this.uploadFrom(t,s):r.isDirectory()&&(await this._openDir(s),await this._uploadToWorkingDir(t),await this.cdup())}}async downloadToDir(e,t){return this._exitAtCurrentDirectory((async()=>(t&&await this.cd(t),await this._downloadFromWorkingDir(e))))}async _downloadFromWorkingDir(e){await async function(e){try{await g(e)}catch(t){await w(e,{recursive:!0})}}(e);for(const t of await this.list()){const s=(0,o.join)(e,t.name);t.isDirectory?(await this.cd(t.name),await this._downloadFromWorkingDir(s),await this.cdup()):t.isFile&&await this.downloadTo(s,t.name)}}async ensureDir(e){e.startsWith("/")&&await this.cd("/");const t=e.split("/").filter((e=>""!==e));for(const e of t)await this._openDir(e)}async _openDir(e){await this.sendIgnoringError("MKD "+e),await this.cd(e)}async removeEmptyDir(e){const t=await this.protectWhitespace(e);return this.send(`RMD ${t}`)}async protectWhitespace(e){if(!e.startsWith(" "))return e;const t=await this.pwd();return(t.endsWith("/")?t:t+"/")+e}async _exitAtCurrentDirectory(e){const t=await this.pwd();try{return await e()}finally{this.closed||await S((()=>this.cd(t)))}}_enterFirstCompatibleMode(e){return async t=>{let s;t.log("Trying to find optimal transfer strategy...");for(const r of e)try{const e=await r(t);return t.log("Optimal transfer strategy found."),this.prepareTransfer=r,e}catch(e){s=e}throw new Error(`None of the available transfer strategies work. Last error response was '${s}'.`)}}async upload(e,t,s={}){return this.ftp.log("Warning: upload() has been deprecated, use uploadFrom()."),this.uploadFrom(e,t,s)}async append(e,t,s={}){return this.ftp.log("Warning: append() has been deprecated, use appendFrom()."),this.appendFrom(e,t,s)}async download(e,t,s=0){return this.ftp.log("Warning: download() has been deprecated, use downloadTo()."),this.downloadTo(e,t,s)}async uploadDir(e,t){return this.ftp.log("Warning: uploadDir() has been deprecated, use uploadFromDir()."),this.uploadFromDir(e,t)}async downloadDir(e){return this.ftp.log("Warning: downloadDir() has been deprecated, use downloadToDir()."),this.downloadToDir(e)}}},757:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.FileInfo=t.FileType=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.File=1]="File",e[e.Directory=2]="Directory",e[e.SymbolicLink=3]="SymbolicLink"}(s||(t.FileType=s={}));class r{constructor(e){this.name=e,this.type=s.Unknown,this.size=0,this.rawModifiedAt="",this.modifiedAt=void 0,this.permissions=void 0,this.hardLinkCount=void 0,this.link=void 0,this.group=void 0,this.user=void 0,this.uniqueID=void 0,this.name=e}get isDirectory(){return this.type===s.Directory}get isSymbolicLink(){return this.type===s.SymbolicLink}get isFile(){return this.type===s.File}get date(){return this.rawModifiedAt}set date(e){this.rawModifiedAt=e}}t.FileInfo=r,r.UnixPermission={Read:4,Write:2,Execute:1}},326:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FTPContext=t.FTPError=void 0;const r=s(278),o=s(912);class i extends Error{constructor(e){super(e.message),this.name=this.constructor.name,this.code=e.code}}function n(){}t.FTPError=i,t.FTPContext=class{constructor(e=0,t="utf8"){this.timeout=e,this.verbose=!1,this.ipFamily=void 0,this.tlsOptions={},this._partialResponse="",this._encoding=t,this._socket=this.socket=this._newSocket(),this._dataSocket=void 0}close(){const e=this._task?"User closed client during task":"User closed client",t=new Error(e);this.closeWithError(t)}closeWithError(e){this._closingError||(this._closingError=e,this._closeControlSocket(),this._closeSocket(this._dataSocket),this._passToHandler(e),this._stopTrackingTask())}get closed(){return void 0===this.socket.remoteAddress||void 0!==this._closingError}reset(){this.socket=this._newSocket()}get socket(){return this._socket}set socket(e){this.dataSocket=void 0,this.tlsOptions={},this._partialResponse="",this._socket&&(e.localPort===this._socket.localPort?this._removeSocketListeners(this.socket):this._closeControlSocket()),e&&(this._closingError=void 0,e.setTimeout(0),e.setEncoding(this._encoding),e.setKeepAlive(!0),e.on("data",(e=>this._onControlSocketData(e))),e.on("end",(()=>this.closeWithError(new Error("Server sent FIN packet unexpectedly, closing connection.")))),e.on("close",(e=>{e||this.closeWithError(new Error("Server closed connection unexpectedly."))})),this._setupDefaultErrorHandlers(e,"control socket")),this._socket=e}get dataSocket(){return this._dataSocket}set dataSocket(e){this._closeSocket(this._dataSocket),e&&(e.setTimeout(0),this._setupDefaultErrorHandlers(e,"data socket")),this._dataSocket=e}get encoding(){return this._encoding}set encoding(e){this._encoding=e,this.socket&&this.socket.setEncoding(e)}send(e){const t=e.startsWith("PASS")?"> PASS ###":`> ${e}`;this.log(t),this._socket.write(e+"\r\n",this.encoding)}request(e){return this.handle(e,((e,t)=>{e instanceof Error?t.reject(e):t.resolve(e)}))}handle(e,t){if(this._task){const e=new Error("User launched a task while another one is still running. Forgot to use 'await' or '.then()'?");e.stack+=`\nRunning task launched at: ${this._task.stack}`,this.closeWithError(e)}return new Promise(((s,r)=>{if(this._task={stack:(new Error).stack||"Unknown call stack",responseHandler:t,resolver:{resolve:e=>{this._stopTrackingTask(),s(e)},reject:e=>{this._stopTrackingTask(),r(e)}}},this._closingError){const e=new Error(`Client is closed because ${this._closingError.message}`);return e.stack+=`\nClosing reason: ${this._closingError.stack}`,e.code=void 0!==this._closingError.code?this._closingError.code:"0",void this._passToHandler(e)}this.socket.setTimeout(this.timeout),e&&this.send(e)}))}log(e){this.verbose&&console.log(e)}get hasTLS(){return"encrypted"in this._socket}_stopTrackingTask(){this.socket.setTimeout(0),this._task=void 0}_onControlSocketData(e){this.log(`< ${e}`);const t=this._partialResponse+e,s=(0,o.parseControlResponse)(t);this._partialResponse=s.rest;for(const e of s.messages){const t=parseInt(e.substr(0,3),10),s={code:t,message:e},r=t>=400?new i(s):void 0;this._passToHandler(r||s)}}_passToHandler(e){this._task&&this._task.responseHandler(e,this._task.resolver)}_setupDefaultErrorHandlers(e,t){e.once("error",(e=>{e.message+=` (${t})`,this.closeWithError(e)})),e.once("close",(e=>{e&&this.closeWithError(new Error(`Socket closed due to transmission error (${t})`))})),e.once("timeout",(()=>{e.destroy(),this.closeWithError(new Error(`Timeout (${t})`))}))}_closeControlSocket(){this._removeSocketListeners(this._socket),this._socket.on("error",n),this.send("QUIT"),this._closeSocket(this._socket)}_closeSocket(e){e&&(this._removeSocketListeners(e),e.on("error",n),e.destroy())}_removeSocketListeners(e){e.removeAllListeners(),e.removeAllListeners("timeout"),e.removeAllListeners("data"),e.removeAllListeners("end"),e.removeAllListeners("error"),e.removeAllListeners("close"),e.removeAllListeners("connect")}_newSocket(){return new r.Socket}}},106:(e,t)=>{function s(){}Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressTracker=void 0,t.ProgressTracker=class{constructor(){this.bytesOverall=0,this.intervalMs=500,this.onStop=s,this.onHandle=s}reportTo(e=s){this.onHandle=e}start(e,t,r){let o=0;this.onStop=function(e,t){const r=setInterval(t,e);return t(),e=>{clearInterval(r),e&&t(),t=s}}(this.intervalMs,(()=>{const s=e.bytesRead+e.bytesWritten;this.bytesOverall+=s-o,o=s,this.onHandle({name:t,type:r,bytes:s,bytesOverall:this.bytesOverall})}))}stop(){this.onStop(!1)}updateAndStop(){this.onStop(!0)}}},159:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},861:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StringWriter=void 0;const r=s(203);class o extends r.Writable{constructor(){super(...arguments),this.buf=Buffer.alloc(0)}_write(e,t,s){e instanceof Buffer?(this.buf=Buffer.concat([this.buf,e]),s(null)):s(new Error("StringWriter expects chunks of type 'Buffer'."))}getText(e){return this.buf.toString(e)}}t.StringWriter=o},943:function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),t.enterPassiveModeIPv6=t.enterPassiveModeIPv4=void 0,o(s(648),t),o(s(326),t),o(s(757),t),o(s(184),t),o(s(159),t);var i=s(844);Object.defineProperty(t,"enterPassiveModeIPv4",{enumerable:!0,get:function(){return i.enterPassiveModeIPv4}}),Object.defineProperty(t,"enterPassiveModeIPv6",{enumerable:!0,get:function(){return i.enterPassiveModeIPv6}})},991:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ipIsPrivateV4Address=t.upgradeSocket=t.describeAddress=t.describeTLS=void 0;const r=s(756);t.describeTLS=function(e){if(e instanceof r.TLSSocket){return e.getProtocol()||"Server socket or disconnected client socket"}return"No encryption"},t.describeAddress=function(e){return"IPv6"===e.remoteFamily?`[${e.remoteAddress}]:${e.remotePort}`:`${e.remoteAddress}:${e.remotePort}`},t.upgradeSocket=function(e,t){return new Promise(((s,o)=>{const i=Object.assign({},t,{socket:e}),n=(0,r.connect)(i,(()=>{!1===i.rejectUnauthorized||n.authorized?(n.removeAllListeners("error"),s(n)):o(n.authorizationError)})).once("error",(e=>{o(e)}))}))},t.ipIsPrivateV4Address=function(e=""){e.startsWith("::ffff:")&&(e=e.substr(7));const t=e.split(".").map((e=>parseInt(e,10)));return 10===t[0]||172===t[0]&&t[1]>=16&&t[1]<=31||192===t[0]&&168===t[1]||"127.0.0.1"===e}},912:(e,t)=>{function s(e){return/^\d\d\d(?:$| )/.test(e)}function r(e){return/^\d\d\d-/.test(e)}function o(e){return""!==e.trim()}Object.defineProperty(t,"__esModule",{value:!0}),t.positiveIntermediate=t.positiveCompletion=t.isMultiline=t.isSingleLine=t.parseControlResponse=void 0,t.parseControlResponse=function(e){const t=e.split(/\r?\n/).filter(o),i=[];let n,a=0;for(let e=0;e<t.length;e++){const o=t[e];if(n)n.test(o)&&(n=void 0,i.push(t.slice(a,e+1).join("\n")));else if(r(o)){const t=o.substr(0,3);n=new RegExp(`^${t}(?:$| )`),a=e}else s(o)&&i.push(o)}return{messages:i,rest:n?t.slice(a).join("\n")+"\n":""}},t.isSingleLine=s,t.isMultiline=r,t.positiveCompletion=function(e){return e>=200&&e<300},t.positiveIntermediate=function(e){return e>=300&&e<400}},184:function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,o)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.parseList=void 0;const n=[i(s(948)),i(s(998)),i(s(798))];function a(e){return""!==e.trim()}function c(e){return!e.startsWith("total")}const d=/\r?\n/;t.parseList=function(e){const t=e.split(d).filter(a).filter(c);if(0===t.length)return[];const s=t[t.length-1],r=(o=s,n.find((e=>!0===e.testLine(o))));var o;if(!r)throw new Error("This library only supports MLSD, Unix- or DOS-style directory listing. Your FTP server seems to be using another format. You can see the transmitted listing when setting `client.ftp.verbose = true`. You can then provide a custom parser to `client.parseList`, see the documentation for details.");const i=t.map(r.parseLine).filter((e=>void 0!==e));return r.transformList(i)}},948:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformList=t.parseLine=t.testLine=void 0;const r=s(757),o=new RegExp("(\\S+)\\s+(\\S+)\\s+(?:(<DIR>)|([0-9]+))\\s+(\\S.*)");t.testLine=function(e){return/^\d{2}/.test(e)&&o.test(e)},t.parseLine=function(e){const t=e.match(o);if(null===t)return;const s=t[5];if("."===s||".."===s)return;const i=new r.FileInfo(s);return"<DIR>"===t[3]?(i.type=r.FileType.Directory,i.size=0):(i.type=r.FileType.File,i.size=parseInt(t[4],10)),i.rawModifiedAt=t[1]+" "+t[2],i},t.transformList=function(e){return e}},798:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseMLSxDate=t.transformList=t.parseLine=t.testLine=void 0;const r=s(757);function o(e,t){t.size=parseInt(e,10)}const i={size:o,sizd:o,unique:(e,t)=>{t.uniqueID=e},modify:(e,t)=>{t.modifiedAt=a(e),t.rawModifiedAt=t.modifiedAt.toISOString()},type:(e,t)=>{if(e.startsWith("OS.unix=slink"))return t.type=r.FileType.SymbolicLink,t.link=e.substr(e.indexOf(":")+1),1;switch(e){case"file":t.type=r.FileType.File;break;case"dir":t.type=r.FileType.Directory;break;case"OS.unix=symlink":t.type=r.FileType.SymbolicLink;break;case"cdir":case"pdir":return 2;default:t.type=r.FileType.Unknown}return 1},"unix.mode":(e,t)=>{const s=e.substr(-3);t.permissions={user:parseInt(s[0],10),group:parseInt(s[1],10),world:parseInt(s[2],10)}},"unix.ownername":(e,t)=>{t.user=e},"unix.owner":(e,t)=>{void 0===t.user&&(t.user=e)},get"unix.uid"(){return this["unix.owner"]},"unix.groupname":(e,t)=>{t.group=e},"unix.group":(e,t)=>{void 0===t.group&&(t.group=e)},get"unix.gid"(){return this["unix.group"]}};function n(e,t){const s=e.indexOf(t);return[e.substr(0,s),e.substr(s+t.length)]}function a(e){return new Date(Date.UTC(+e.slice(0,4),+e.slice(4,6)-1,+e.slice(6,8),+e.slice(8,10),+e.slice(10,12),+e.slice(12,14),+e.slice(15,18)))}t.testLine=function(e){return/^\S+=\S+;/.test(e)||e.startsWith(" ")},t.parseLine=function(e){const[t,s]=n(e," ");if(""===s||"."===s||".."===s)return;const o=new r.FileInfo(s),a=t.split(";");for(const e of a){const[t,s]=n(e,"=");if(!s)continue;const r=i[t.toLowerCase()];if(r&&2===r(s,o))return}return o},t.transformList=function(e){const t=new Map;for(const s of e)s.isSymbolicLink||void 0===s.uniqueID||t.set(s.uniqueID,s);const s=[];for(const r of e){if(r.isSymbolicLink&&void 0!==r.uniqueID&&void 0===r.link){const e=t.get(r.uniqueID);void 0!==e&&(r.link=e.name)}!r.name.includes("/")&&s.push(r)}return s},t.parseMLSxDate=a},998:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformList=t.parseLine=t.testLine=void 0;const r=s(757),o=new RegExp("([bcdelfmpSs-])(((r|-)(w|-)([xsStTL-]))((r|-)(w|-)([xsStTL-]))((r|-)(w|-)([xsStTL-]?)))\\+?\\s*(\\d+)\\s+(?:(\\S+(?:\\s\\S+)*?)\\s+)?(?:(\\S+(?:\\s\\S+)*)\\s+)?(\\d+(?:,\\s*\\d+)?)\\s+((?:\\d+[-/]\\d+[-/]\\d+)|(?:\\S{3}\\s+\\d{1,2})|(?:\\d{1,2}\\s+\\S{3})|(?:\\d{1,2}月\\s+\\d{1,2}日))\\s+((?:\\d+(?::\\d+)?)|(?:\\d{4}年))\\s(.*)");function i(e,t,s){let o=0;"-"!==e&&(o+=r.FileInfo.UnixPermission.Read),"-"!==t&&(o+=r.FileInfo.UnixPermission.Write);const i=s.charAt(0);return"-"!==i&&i.toUpperCase()!==i&&(o+=r.FileInfo.UnixPermission.Execute),o}t.testLine=function(e){return o.test(e)},t.parseLine=function(e){const t=e.match(o);if(null===t)return;const s=t[21];if("."===s||".."===s)return;const n=new r.FileInfo(s);switch(n.size=parseInt(t[18],10),n.user=t[16],n.group=t[17],n.hardLinkCount=parseInt(t[15],10),n.rawModifiedAt=t[19]+" "+t[20],n.permissions={user:i(t[4],t[5],t[6]),group:i(t[8],t[9],t[10]),world:i(t[12],t[13],t[14])},t[1].charAt(0)){case"d":n.type=r.FileType.Directory;break;case"e":case"l":n.type=r.FileType.SymbolicLink;break;case"b":case"c":case"f":case"-":n.type=r.FileType.File;break;default:n.type=r.FileType.Unknown}if(n.isSymbolicLink){const e=s.indexOf(" -> ");-1!==e&&(n.name=s.substring(0,e),n.link=s.substring(e+4))}return n},t.transformList=function(e){return e}},844:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.downloadTo=t.uploadFrom=t.connectForPassiveTransfer=t.parsePasvResponse=t.enterPassiveModeIPv4=t.parseEpsvResponse=t.enterPassiveModeIPv6=void 0;const r=s(991),o=s(203),i=s(756),n=s(912);function a(e){const t=e.match(/[|!]{3}(.+)[|!]/);if(null===t||void 0===t[1])throw new Error(`Can't parse response to 'EPSV': ${e}`);const s=parseInt(t[1],10);if(Number.isNaN(s))throw new Error(`Can't parse response to 'EPSV', port is not a number: ${e}`);return s}function c(e){const t=e.match(/([-\d]+,[-\d]+,[-\d]+,[-\d]+),([-\d]+),([-\d]+)/);if(null===t||4!==t.length)throw new Error(`Can't parse response to 'PASV': ${e}`);return{host:t[1].replace(/,/g,"."),port:256*(255&parseInt(t[2],10))+(255&parseInt(t[3],10))}}function d(e,t,s){return new Promise(((r,o)=>{let n=s._newSocket();const a=function(e){e.message="Can't open data connection in passive mode: "+e.message,o(e)},c=function(){n.destroy(),o(new Error(`Timeout when trying to open data connection to ${e}:${t}`))};n.setTimeout(s.timeout),n.on("error",a),n.on("timeout",c),n.connect({port:t,host:e,family:s.ipFamily},(()=>{s.socket instanceof i.TLSSocket&&(n=(0,i.connect)(Object.assign({},s.tlsOptions,{socket:n,session:s.socket.getSession()}))),n.removeListener("error",a),n.removeListener("timeout",c),s.dataSocket=n,r()}))}))}t.enterPassiveModeIPv6=async function(e){const t=await e.request("EPSV"),s=a(t.message);if(!s)throw new Error("Can't parse EPSV response: "+t.message);const r=e.socket.remoteAddress;if(void 0===r)throw new Error("Control socket is disconnected, can't get remote address.");return await d(r,s,e),t},t.parseEpsvResponse=a,t.enterPassiveModeIPv4=async function(e){const t=await e.request("PASV"),s=c(t.message);if(!s)throw new Error("Can't parse PASV response: "+t.message);const o=e.socket.remoteAddress;return(0,r.ipIsPrivateV4Address)(s.host)&&o&&!(0,r.ipIsPrivateV4Address)(o)&&(s.host=o),await d(s.host,s.port,e),t},t.parsePasvResponse=c,t.connectForPassiveTransfer=d;class l{constructor(e,t){this.ftp=e,this.progress=t,this.response=void 0,this.dataTransferDone=!1}onDataStart(e,t){if(void 0===this.ftp.dataSocket)throw new Error("Data transfer should start but there is no data connection.");this.ftp.socket.setTimeout(0),this.ftp.dataSocket.setTimeout(this.ftp.timeout),this.progress.start(this.ftp.dataSocket,e,t)}onDataDone(e){this.progress.updateAndStop(),this.ftp.socket.setTimeout(this.ftp.timeout),this.ftp.dataSocket&&this.ftp.dataSocket.setTimeout(0),this.dataTransferDone=!0,this.tryResolve(e)}onControlDone(e,t){this.response=t,this.tryResolve(e)}onError(e,t){this.progress.updateAndStop(),this.ftp.socket.setTimeout(this.ftp.timeout),this.ftp.dataSocket=void 0,e.reject(t)}onUnexpectedRequest(e){const t=new Error(`Unexpected FTP response is requesting an answer: ${e.message}`);this.ftp.closeWithError(t)}tryResolve(e){this.dataTransferDone&&void 0!==this.response&&(this.ftp.dataSocket=void 0,e.resolve(this.response))}}t.uploadFrom=function(e,t){const s=new l(t.ftp,t.tracker),i=`${t.command} ${t.remotePath}`;return t.ftp.handle(i,((i,a)=>{if(i instanceof Error)s.onError(a,i);else if(150===i.code||125===i.code){const i=t.ftp.dataSocket;if(!i)return void s.onError(a,new Error("Upload should begin but no data connection is available."));const n=!("getCipher"in i)||void 0!==i.getCipher();c=i,"secureConnect",d=()=>{t.ftp.log(`Uploading to ${(0,r.describeAddress)(i)} (${(0,r.describeTLS)(i)})`),s.onDataStart(t.remotePath,t.type),(0,o.pipeline)(e,i,(e=>{e?s.onError(a,e):s.onDataDone(a)}))},!0===n?d():c.once("secureConnect",(()=>d()))}else(0,n.positiveCompletion)(i.code)?s.onControlDone(a,i):(0,n.positiveIntermediate)(i.code)&&s.onUnexpectedRequest(i);var c,d}))},t.downloadTo=function(e,t){if(!t.ftp.dataSocket)throw new Error("Download will be initiated but no data connection is available.");const s=new l(t.ftp,t.tracker);return t.ftp.handle(t.command,((i,a)=>{if(i instanceof Error)s.onError(a,i);else if(150===i.code||125===i.code){const i=t.ftp.dataSocket;if(!i)return void s.onError(a,new Error("Download should begin but no data connection is available."));t.ftp.log(`Downloading from ${(0,r.describeAddress)(i)} (${(0,r.describeTLS)(i)})`),s.onDataStart(t.remotePath,t.type),(0,o.pipeline)(i,e,(e=>{e?s.onError(a,e):s.onDataDone(a)}))}else 350===i.code?t.ftp.send("RETR "+t.remotePath):(0,n.positiveCompletion)(i.code)?s.onControlDone(a,i):(0,n.positiveIntermediate)(i.code)&&s.onUnexpectedRequest(i)}))}},896:e=>{e.exports=require("fs")},278:e=>{e.exports=require("net")},928:e=>{e.exports=require("path")},203:e=>{e.exports=require("stream")},756:e=>{e.exports=require("tls")},23:e=>{e.exports=require("util")}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,s),i.exports}(()=>{var e=s(943),t=s(928);const r=require("process");const o="ftp.3gpp.org";function i(e){const[t,s]=e.split(" "),[r,o,i]=t.split("-").map(Number),n=i>=98?1900+i:2e3+i,[a,c]=s.substring(0,s.length-2).split(":").map(Number),d=s.substring(s.length-2);return new Date(n,r-1,o,"PM"===d?a+12:a,c)}const[,,n,a,c]=r.argv;let d,l;(function(s,r,n){return a=this,c=void 0,l=function*(){const a=function(e){const t=e.indexOf(".");if(-1===t)throw Error("Spec must be in a form of ab.cde[-f]");return e.substring(0,t)}(s),c=`/Specs/archive/${a}_series/${s}`,d=new e.Client;return d.access({host:o}).then((()=>d.cd(c))).then((()=>d.list())).then((e=>e.filter((e=>{const{name:s}=(0,t.parse)(e.name),o=s.lastIndexOf("-");if(-1===o)throw Error("Spec must be in a form of AB.CDE[-F]-xyz or AB.CDE[-F]-uvwxyz");const a=6===(c=s.substring(o+1)).length?Number(c.substring(0,2)):Object.fromEntries("123456789abcdefghijklmnopqrstuvwxyz".split("").map(((e,t)=>[e,t+1])))[c[0]];var c;if("*"!==r&&a!==Number(r))return!1;if("*"===n)return!0;const d=i(e.rawModifiedAt).getTime(),[l,u]=n.split("-").map(Number),p=new Date(l,u-1).getTime(),h=new Date(l,u+2).getTime();return d>=p&&d<h})).map((e=>Object.assign(Object.assign({path:c},e),{date:i(e.rawModifiedAt)}))).sort(((e,t)=>t.date.getTime()-e.date.getTime())))).catch((e=>Promise.reject(e))).finally((()=>d.close()))},new((d=void 0)||(d=Promise))((function(e,t){function s(e){try{o(l.next(e))}catch(e){t(e)}}function r(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof d?o:new d((function(e){e(o)}))).then(s,r)}o((l=l.apply(a,c||[])).next())}));var a,c,d,l})(n,a,c).then((t=>{if("*"!==a&&"*"!==c){if(l=t[0],!l)throw Error("The requested spec not found");return d=new e.Client,d.access({host:o})}console.table(t,["path","name","date","size"])})).then((()=>{if(!d)return;const{path:e,name:s}=l,o=(0,t.resolve)((0,r.cwd)(),s);return console.log(`Downloading the requested spec to ${o}...`),d.downloadTo(o,`${e}/${s}`)})).then((()=>{console.log("Done")})).catch((e=>{console.error(e)})).finally((()=>d&&d.close()))})()})();